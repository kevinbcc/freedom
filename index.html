<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÁõÆÊ®ôÂÄíÊï∏ ‚ú®</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#FFF5F7">
    <style>
        :root {
            --theme-primary: #FF9AA2;
            --theme-secondary: #FFB7B2;
            --theme-light: #FFF5F7;
            --theme-background: linear-gradient(135deg, #FFF5F7 0%, #FFE8E8 50%, #FFF0E6 100%);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: var(--theme-background);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            overscroll-behavior: none;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 30px 20px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(255, 182, 193, 0.3);
            backdrop-filter: blur(10px);
            margin: auto;
            max-height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 24px;
            color: var(--theme-primary);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 13px;
            color: #FF8A8F;
            opacity: 0.8;
            min-height: 1.2em;
        }

        .progress-ring {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }

        .progress-ring-circle {
            fill: none;
            stroke: #FFE5E5;
            stroke-width: 10;
        }

        .progress-ring-progress {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease-in-out;
        }

        .progress-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 100%;
        }

        .days-remaining, .stat-value {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .animate-pop {
            transform: scale(1.1);
            opacity: 0.8;
        }
        
        .days-remaining {
            font-size: 56px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin-bottom: 8px;
        }

        .days-label {
            font-size: 15px;
            color: var(--theme-primary);
            font-weight: 500;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--theme-light), #FFE8E8);
            border-radius: 18px;
            padding: 18px 15px;
            text-align: center;
            border: 2px solid rgba(255, 182, 193, 0.2);
        }

        .stat-value {
            font-size: 26px;
            font-weight: 700;
            color: var(--theme-secondary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--theme-primary);
            opacity: 1;
            font-weight: 500;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin: 20px 0;
        }

        .btn {
            flex: 1; padding: 16px 12px; border: none; border-radius: 18px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary));
            color: white;
            box-shadow: 0 8px 20px rgba(255, 154, 162, 0.3);
        }
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(255, 154, 162, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--theme-secondary);
            border: 2px solid #FFE5E5;
        }
        .btn-secondary:hover:not(:disabled) {
            background: var(--theme-light);
            transform: translateY(-2px);
        }
        
        .btn:active:not(:disabled) { transform: translateY(0); }

        .reset-section {
            margin-top: auto;
            text-align: center;
        }

        .btn-reset {
            background: none;
            color: var(--theme-primary);
            padding: 12px 28px;
            border: none;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-reset:hover {
            background: #FFDAC1;
        }
        
        .message { text-align: center; margin-top: 20px; padding: 15px; border-radius: 15px; background: linear-gradient(135deg, var(--theme-light), #FFE8E8); color: var(--theme-primary); font-size: 14px; font-weight: 500; opacity: 0; transform: translateY(-10px); transition: opacity 0.3s ease, transform 0.3s ease; display: none; }
        .message.show { opacity: 1; transform: translateY(0); display: block; }
        .celebration { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; pointer-events: none; overflow: hidden; z-index: 10; }
        .celebration.show { display: block; }
        .confetti-piece { position: absolute; width: 10px; height: 20px; opacity: 0.9; animation: confetti-fall linear forwards; background-color: var(--confetti-color); will-change: transform; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        @keyframes confetti-fall { 0% { transform: translateY(-100%) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(var(--rotation)); opacity: 0; } }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        .modal-title {
            font-size: 20px;
            color: var(--theme-primary);
            text-align: center;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            font-size: 14px;
            color: var(--theme-secondary);
            margin-bottom: 8px;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #FFE5E5;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        .form-group input:focus {
            border-color: var(--theme-primary);
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { padding: 25px 18px; border-radius: 25px; }
            .title { font-size: 22px; }
            .subtitle { font-size: 12px; }
            .progress-ring { width: 180px; height: 180px; margin: 15px auto; }
            .days-remaining { font-size: 48px; }
            .days-label { font-size: 14px; }
            .stat-card { padding: 15px 12px; }
            .stat-value { font-size: 24px; }
            .stat-label { font-size: 11px; }
            .btn { padding: 14px 10px; font-size: 15px; }
            .btn-reset { padding: 11px 24px; font-size: 13px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title" id="goalTitle">üå∏ ÁõÆÊ®ôÂÄíÊï∏ üå∏</div>
            <div class="subtitle" id="goalSubtitle">ÁÇ∫Ëá™Â∑±Ë®≠ÂÆö‰∏ÄÂÄãÁõÆÊ®ôÂêßÔºÅ</div>
        </div>

        <div class="progress-ring" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <svg viewBox="0 0 200 200">
                <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:var(--theme-primary);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:var(--theme-secondary);stop-opacity:1" />
                    </linearGradient>
                </defs>
                <circle class="progress-ring-circle" cx="100" cy="100" r="85"/>
                <circle class="progress-ring-progress" cx="100" cy="100" r="85" id="progress"/>
            </svg>
            <div class="progress-content">
                <div class="days-remaining" id="daysRemaining">...</div>
                <div class="days-label">Â§©</div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalDays">...</div>
                <div class="stat-label">Á∏ΩÂ§©Êï∏</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completedDays">...</div>
                <div class="stat-label">Â∑≤ÂÆåÊàê</div>
            </div>
        </div>

        <div class="button-group">
            <button class="btn btn-secondary" id="decreaseBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12H3"></path></svg>
                ÈÄÄ‰∏ÄÂ§©
            </button>
            <button class="btn btn-primary" id="increaseBtn">
                 <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg>
                ÂÆåÊàê‰∏ÄÂ§©
            </button>
        </div>

        <div class="celebration" id="celebration"></div>
        <div class="message" id="message"></div>

        <div class="reset-section">
            <button class="btn-reset" id="resetBtn">Ë®≠ÂÆöÊñ∞ÁõÆÊ®ô</button>
        </div>
    </div>
    
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-title">Ë®≠ÂÆö‰Ω†ÁöÑÊñ∞ÁõÆÊ®ô</div>
            <div class="form-group">
                <label for="goalNameInput">ÁõÆÊ®ôÂêçÁ®±</label>
                <input type="text" id="goalNameInput" placeholder="‰æãÂ¶ÇÔºöPMP ËÄÉË©¶ÂÄíÊï∏">
            </div>
            <div class="form-group">
                <label for="totalDaysInput">Á∏ΩÂÖ±Â§©Êï∏</label>
                <input type="number" id="totalDaysInput" placeholder="‰æãÂ¶ÇÔºö30" min="1">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancelSettingsBtn">ÂèñÊ∂à</button>
                <button class="btn btn-primary" id="saveSettingsBtn">ÂÑ≤Â≠òÁõÆÊ®ô</button>
            </div>
        </div>
    </div>

    <script>
        const dom = {
            goalTitle: document.getElementById('goalTitle'),
            goalSubtitle: document.getElementById('goalSubtitle'),
            daysRemaining: document.getElementById('daysRemaining'),
            totalDays: document.getElementById('totalDays'),
            completedDays: document.getElementById('completedDays'),
            progress: document.getElementById('progress'),
            increaseBtn: document.getElementById('increaseBtn'),
            decreaseBtn: document.getElementById('decreaseBtn'),
            resetBtn: document.getElementById('resetBtn'),
            message: document.getElementById('message'),
            celebration: document.getElementById('celebration'),
            progressRing: document.querySelector('.progress-ring'),
            settingsModal: document.getElementById('settingsModal'),
            goalNameInput: document.getElementById('goalNameInput'),
            totalDaysInput: document.getElementById('totalDaysInput'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            cancelSettingsBtn: document.getElementById('cancelSettingsBtn')
        };

        const state = {
            goalName: 'üå∏ ÁõÆÊ®ôÂÄíÊï∏ üå∏',
            totalDays: 30,
            remainingDays: 30
        };

        const motivationalQuotes = [
            "‰∏ÄÂ§©‰∏ÄÂ§©ÈÉΩÂú®ÈÄ≤Ê≠•‰∏≠ ‚ú®",
            "Â†ÖÊåÅÊòØÈÄöÂæÄÊàêÂäüÊúÄÂø´ÁöÑÊç∑Âæë„ÄÇ",
            "‰ªäÂ§©ÁöÑ‰Ω†ÔºåÊØîÊò®Â§©Êõ¥Ê£í‰∫ÜÔºÅ",
            "Âà•Âøò‰∫Ü‰ºëÊÅØÔºåÊòØÁÇ∫‰∫ÜËµ∞Êõ¥Èï∑ÈÅ†ÁöÑË∑Ø„ÄÇ",
            "Â∞àÊ≥®ÊñºÈÅéÁ®ãÔºåÁµêÊûúËá™ÁÑ∂ÊúÉ‰æÜ„ÄÇ",
            "Áõ∏‰ø°Ëá™Â∑±Ôºå‰Ω†ÈÅ†ÊØîÊÉ≥ÂÉè‰∏≠Êõ¥Âº∑Â§ß„ÄÇ"
        ];

        function loadData() {
            const savedState = JSON.parse(localStorage.getItem('countdownState'));
            if (savedState) {
                Object.assign(state, savedState);
            } else {
                setTimeout(() => showSettingsModal(), 500);
            }
        }

        function saveData() {
            localStorage.setItem('countdownState', JSON.stringify(state));
        }
        
        function triggerHapticFeedback() {
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
        
        function animateElement(element, value) {
            if (element.textContent !== String(value)) {
                element.classList.add('animate-pop');
                setTimeout(() => {
                    element.textContent = value;
                    element.classList.remove('animate-pop');
                }, 150);
            }
        }

        function updateUI() {
            const completedDays = state.totalDays - state.remainingDays;
            const percentage = state.totalDays > 0 ? (completedDays / state.totalDays) * 100 : 0;
            
            dom.goalTitle.textContent = state.goalName;
            
            animateElement(dom.daysRemaining, state.remainingDays);
            animateElement(dom.totalDays, state.totalDays);
            animateElement(dom.completedDays, completedDays);

            const radius = 85;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            dom.progress.style.strokeDasharray = `${circumference} ${circumference}`;
            dom.progress.style.strokeDashoffset = offset;
            
            dom.progressRing.setAttribute('aria-valuenow', completedDays);
            dom.progressRing.setAttribute('aria-valuemax', state.totalDays);

            dom.increaseBtn.disabled = state.remainingDays === 0;
            dom.decreaseBtn.disabled = state.remainingDays === state.totalDays;

            saveData();
        }

        function showMessage(text) {
            dom.message.textContent = text;
            dom.message.classList.add('show');
            setTimeout(() => {
                dom.message.classList.remove('show');
            }, 3000);
        }
        
        function updateQuote() {
            const randomIndex = Math.floor(Math.random() * motivationalQuotes.length);
            dom.goalSubtitle.textContent = motivationalQuotes[randomIndex];
        }

        function showSettingsModal() {
            dom.goalNameInput.value = state.goalName === 'üå∏ ÁõÆÊ®ôÂÄíÊï∏ üå∏' ? '' : state.goalName;
            dom.totalDaysInput.value = state.totalDays;
            dom.settingsModal.classList.add('show');
            dom.goalNameInput.focus();
        }

        function hideSettingsModal() {
            dom.settingsModal.classList.remove('show');
        }

        function handleSaveSettings() {
            const newGoalName = dom.goalNameInput.value.trim();
            const newTotalDays = parseInt(dom.totalDaysInput.value);

            if (!newGoalName) {
                showMessage("Ë´ãÁµ¶‰Ω†ÁöÑÁõÆÊ®ôÂèñÂÄãÂêçÂ≠óÂêßÔºÅ");
                return;
            }
            if (isNaN(newTotalDays) || newTotalDays <= 0) {
                showMessage("Á∏ΩÂ§©Êï∏ÂøÖÈ†àÊòØÊ≠£Êï∏ÂñîÔºÅ");
                return;
            }

            state.goalName = newGoalName;
            state.totalDays = newTotalDays;
            state.remainingDays = newTotalDays;
            
            updateUI();
            updateQuote();
            hideSettingsModal();
            showMessage('Êñ∞ÁõÆÊ®ôÂ∑≤Ë®≠ÂÆöÔºÅÂä†Ê≤π üí™');
        }

        dom.increaseBtn.addEventListener('click', () => {
            if (state.remainingDays > 0) {
                triggerHapticFeedback();
                state.remainingDays--;
                updateUI();
                updateQuote();
                
                if (state.remainingDays === 0) {
                    showCelebration();
                    showMessage(`üéä ÊÅ≠ÂñúÔºÅ‰Ω†ÂÆåÊàê‰∫Ü„Äå${state.goalName}„ÄçÔºÅ`);
                } else if (state.remainingDays <= 10) {
                    showMessage(`üí™ Âä†Ê≤πÔºÅÂè™Ââ© ${state.remainingDays} Â§©‰∫ÜÔºÅ`);
                } else {
                    showMessage('Â§™Ê£í‰∫ÜÔºÅÂèàÂÆåÊàê‰∏ÄÂ§© ‚ú®');
                }
            }
        });

        dom.decreaseBtn.addEventListener('click', () => {
            if (state.remainingDays < state.totalDays) {
                triggerHapticFeedback();
                state.remainingDays++;
                updateUI();
                showMessage('Â∑≤ÈÄÄÂõû‰∏ÄÂ§© ‚Ü©Ô∏è');
            }
        });
        
        dom.resetBtn.addEventListener('click', showSettingsModal);
        dom.saveSettingsBtn.addEventListener('click', handleSaveSettings);
        dom.cancelSettingsBtn.addEventListener('click', hideSettingsModal);
        dom.settingsModal.addEventListener('click', (e) => {
            if (e.target === dom.settingsModal) {
                hideSettingsModal();
            }
        });
        
        function init() {
            loadData();
            updateUI();
            updateQuote();
        }
        
        init();

        function createConfetti() { const el = dom.celebration; el.innerHTML = ''; const colors = ['#ff6347', '#ffa500', '#32cd32', '#1e90ff', '#ff69b4', '#FF9AA2', '#FFB7B2', '#FFD700', '#C0C0C0']; const numPieces = 150; for (let i = 0; i < numPieces; i++) { const piece = document.createElement('div'); piece.classList.add('confetti-piece'); piece.style.left = `${Math.random() * 100}%`; const duration = Math.random() * 3 + 2; piece.style.animationDuration = `${duration}s`; piece.style.animationDelay = `${Math.random() * 1}s`; piece.style.width = `${Math.random() * 10 + 5}px`; piece.style.height = `${Math.random() * 20 + 10}px`; piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]; piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '0'; piece.style.setProperty('--rotation', `${Math.random() * 720 + 360}deg`); el.appendChild(piece); } }
        function showCelebration() { createConfetti(); dom.celebration.classList.add('show'); setTimeout(() => { dom.celebration.classList.remove('show'); dom.celebration.innerHTML = ''; }, 4000); }
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js').then(reg => console.log('Service Worker registered', reg)).catch(err => console.log('Service Worker registration failed', err)); }); }
    </script>
</body>
</html>
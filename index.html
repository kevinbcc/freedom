<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç›®æ¨™å€’æ•¸ âœ¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#FFF5F7">
    <style>
        :root {
            --font-main: 'M PLUS Rounded 1c', 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            --c-spring-primary: #FF9AA2;
            --c-spring-secondary: #FFB7B2;
            --c-spring-bg: linear-gradient(135deg, #FFF5F7 0%, #FFE8E8 50%, #FFF0E6 100%);
            --c-spring-shadow: rgba(255, 154, 162, 0.1);
            
            --c-summer-primary: #B4C6F0;
            --c-summer-secondary: #829ED9;
            --c-summer-bg: linear-gradient(135deg, #F0F4FF 0%, #E6ECFF 100%);
            --c-summer-shadow: rgba(130, 158, 217, 0.1);

            --c-autumn-primary: #E8B48E;
            --c-autumn-secondary: #D49D70;
            --c-autumn-bg: linear-gradient(135deg, #FFF4E8 0%, #FFFAF0 100%);
            --c-autumn-shadow: rgba(212, 157, 112, 0.1);

            --theme-primary: var(--c-spring-primary);
            --theme-secondary: var(--c-spring-secondary);
            --theme-background: var(--c-spring-bg);
            --theme-shadow: var(--c-spring-shadow);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        html, body { height: 100%; overflow: hidden; }
        body { font-family: var(--font-main); background: var(--theme-background); display: flex; justify-content: center; align-items: center; padding: 15px; overscroll-behavior: none; transition: background 0.5s ease; }
        .container { background: rgba(255, 255, 255, 0.95); border-radius: 30px; padding: 30px 20px; max-width: 500px; width: 100%;
            box-shadow: 0px 4px 12px var(--theme-shadow), 0px 16px 32px var(--theme-shadow);
            backdrop-filter: blur(10px); margin: auto; max-height: 100%; overflow: auto; display: flex; flex-direction: column; transition: box-shadow 0.5s ease; }
        
        .main-content.hide { display: none; }
        .celebration-screen.show { display: flex; }

        .header { text-align: center; margin-bottom: 20px; }
        .title { font-size: 30px; color: var(--theme-primary); font-weight: 700; margin-bottom: 8px; }
        .date-display { margin-top: 10px; font-size: 15px; color: var(--theme-secondary); font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 6px; opacity: 0.8; }
        .progress-ring { position: relative; width: 200px; height: 200px; margin: 20px auto; }
        .progress-ring svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .progress-ring-circle { fill: none; stroke: #000000; stroke-opacity: 0.08; stroke-width: 10; }
        .progress-ring-progress { fill: none; stroke: url(#gradient); stroke-width: 10; stroke-linecap: round; transition: stroke-dashoffset 0.5s ease-in-out; }
        .progress-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; }
        .days-remaining, .stat-value { transition: transform 0.3s ease, opacity 0.3s ease; }
        .animate-pop { transform: scale(1.1); opacity: 0.8; }
        .days-remaining { font-size: 56px; font-weight: 700; background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; line-height: 1; margin-bottom: 8px; }
        .days-label { font-size: 20px; color: var(--theme-primary); font-weight: 500; }
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-card { background: rgba(0,0,0,0.02); border-radius: 18px; padding: 18px 15px; text-align: center; border: 1px solid rgba(0,0,0,0.05); }
        .stat-value { font-size: 26px; font-weight: 700; color: var(--theme-secondary); margin-bottom: 5px; }
        .stat-label { font-size: 16px; color: var(--theme-primary); opacity: 1; font-weight: 500; }
        .button-group { display: flex; gap: 12px; margin: 20px 0; }
        .btn { flex: 1; padding: 16px 12px; border: none; border-radius: 18px; font-size: 16px; font-weight: 700; font-family: var(--font-main); cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
        .btn-primary { background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary)); color: white; box-shadow: 0 8px 20px var(--theme-shadow); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 12px 30px var(--theme-shadow); }
        .btn-secondary { background: white; color: var(--theme-secondary); border: 2px solid rgba(0,0,0,0.08); }
        .btn-secondary:hover:not(:disabled) { background: rgba(0,0,0,0.02); transform: translateY(-2px); }
        .btn:active:not(:disabled) { transform: translateY(0); }
        .reset-section { margin-top: auto; text-align: center; padding-top: 15px; }
        .btn-reset { background: none; color: var(--theme-primary); padding: 12px 28px; border: none; border-radius: 15px; font-size: 15px; font-weight: 700; font-family: var(--font-main); cursor: pointer; transition: all 0.3s ease; }
        .btn-reset:hover { background: rgba(0,0,0,0.05); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-overlay.show { opacity: 1; pointer-events: auto; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-title { font-size: 20px; color: var(--theme-primary); text-align: center; margin-bottom: 20px; font-weight: 700; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 14px; color: var(--theme-secondary); margin-bottom: 8px; font-weight: 500; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #EEE; border-radius: 12px; font-size: 16px; outline: none; transition: border-color 0.3s ease; font-family: var(--font-main); }
        .form-group input:focus { border-color: var(--theme-primary); }
        .modal-buttons { display: flex; gap: 10px; margin-top: 25px; }
        .theme-selector { display: flex; justify-content: space-around; margin-top: 10px; }
        .theme-option { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; background-clip: content-box; padding: 2px; transition: border-color 0.3s; }
        .theme-option.selected { border-color: var(--theme-primary); }
        .theme-option[data-theme="spring"] { background-color: var(--c-spring-primary); }
        .theme-option[data-theme="summer"] { background-color: var(--c-summer-primary); }
        .theme-option[data-theme="autumn"] { background-color: var(--c-autumn-primary); }
        .celebration-screen { display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px 20px; }
        .celebration-screen .icon { font-size: 60px; margin-bottom: 20px; }
        .celebration-screen .title { font-size: 22px; font-weight: 700; color: var(--theme-primary); margin-bottom: 10px; }
        .celebration-screen .subtitle { font-size: 14px; color: var(--theme-secondary); margin-bottom: 30px; }
        
        .message { text-align: center; margin: 20px auto 0 auto; width: fit-content; max-width: 90%; padding: 10px 20px; border-radius: 99px; background: rgba(0,0,0,0.04); color: var(--theme-secondary); font-size: 14px; font-weight: 500; opacity: 0; transform: translateY(10px); transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); display: none; }
        .message.show { opacity: 1; transform: translateY(0); display: block; }
        
        @media (max-width: 480px) { body { padding: 10px; } .container { padding: 25px 18px; border-radius: 25px; } .title { font-size: 24px; } .progress-ring { width: 180px; height: 180px; margin: 15px auto; } .days-remaining { font-size: 48px; } .days-label { font-size: 15px; } .stat-card { padding: 15px 12px; } .stat-value { font-size: 24px; } .stat-label { font-size: 12px; } .btn { padding: 14px 10px; font-size: 15px; } .btn-reset { padding: 11px 24px; font-size: 14px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="header">
                <div class="title" id="goalTitle">ğŸŒ¸ ç›®æ¨™å€’æ•¸ ğŸŒ¸</div>
                <div class="date-display" id="currentDateDisplay"></div>
            </div>
            <div class="progress-ring" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                <svg viewBox="0 0 200 200">
                    <defs><linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:var(--theme-primary);stop-opacity:1" /><stop offset="100%" style="stop-color:var(--theme-secondary);stop-opacity:1" /></linearGradient></defs>
                    <circle class="progress-ring-circle" cx="100" cy="100" r="85"/><circle class="progress-ring-progress" cx="100" cy="100" r="85" id="progress"/>
                </svg>
                <div class="progress-content"><div class="days-remaining" id="daysRemaining">...</div><div class="days-label">å¤©</div></div>
            </div>
            <div class="stats">
                <div class="stat-card"><div class="stat-value" id="totalDays">...</div><div class="stat-label">ç¸½å¤©æ•¸</div></div>
                <div class="stat-card"><div class="stat-value" id="completedDays">...</div><div class="stat-label">å·²å®Œæˆ</div></div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" id="decreaseBtn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12H3"></path></svg>é€€ä¸€å¤©</button>
                <button class="btn btn-primary" id="increaseBtn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg>å®Œæˆä¸€å¤©</button>
            </div>
            <div class="message" id="message"></div>
            <div class="reset-section"><button class="btn-reset" id="resetBtn">è¨­å®šæ–°ç›®æ¨™</button></div>
        </div>
        
        <div class="celebration-screen" id="celebrationScreen">
            <div class="icon">ğŸ‰</div>
            <div class="title">å¤ªæ£’äº†ï¼ç›®æ¨™é”æˆï¼</div>
            <div class="subtitle" id="celebrationSubtitle"></div>
            <button class="btn btn-primary" id="startNewGoalBtn">é–‹å•Ÿæˆ‘çš„ä¸‹ä¸€å€‹ç›®æ¨™ï¼</button>
        </div>
    </div>
    
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-title">è¨­å®šä½ çš„æ–°ç›®æ¨™</div>
            <div class="form-group"><label for="goalNameInput">ç›®æ¨™åç¨±</label><input type="text" id="goalNameInput" placeholder="ä¾‹å¦‚ï¼šPMP è€ƒè©¦å€’æ•¸"></div>
            <div class="form-group"><label for="totalDaysInput">ç¸½å…±å¤©æ•¸</label><input type="number" id="totalDaysInput" placeholder="ä¾‹å¦‚ï¼š30" min="1"></div>
            <div class="form-group">
                <label>é¸æ“‡è‰²å½©ä¸»é¡Œ</label>
                <div class="theme-selector" id="themeSelector">
                    <div class="theme-option" data-theme="spring" title="æ˜¥æ—¥æ«»èŠ±"></div>
                    <div class="theme-option" data-theme="summer" title="å¤æ—¥è˜‡æ‰“"></div>
                    <div class="theme-option" data-theme="autumn" title="ç§‹æ—¥æ‹¿éµ"></div>
                </div>
            </div>
            <div class="modal-buttons"><button class="btn btn-secondary" id="cancelSettingsBtn">å–æ¶ˆ</button><button class="btn btn-primary" id="saveSettingsBtn">å„²å­˜ç›®æ¨™</button></div>
        </div>
    </div>

    <script>
        const dom = {
            body: document.body, container: document.querySelector('.container'), mainContent: document.querySelector('.main-content'),
            goalTitle: document.getElementById('goalTitle'), 
            currentDateDisplay: document.getElementById('currentDateDisplay'), daysRemaining: document.getElementById('daysRemaining'),
            totalDays: document.getElementById('totalDays'), completedDays: document.getElementById('completedDays'),
            progress: document.getElementById('progress'), increaseBtn: document.getElementById('increaseBtn'),
            decreaseBtn: document.getElementById('decreaseBtn'), resetBtn: document.getElementById('resetBtn'),
            message: document.getElementById('message'), settingsModal: document.getElementById('settingsModal'),
            goalNameInput: document.getElementById('goalNameInput'), totalDaysInput: document.getElementById('totalDaysInput'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'), cancelSettingsBtn: document.getElementById('cancelSettingsBtn'),
            themeSelector: document.getElementById('themeSelector'), celebrationScreen: document.getElementById('celebrationScreen'),
            celebrationSubtitle: document.getElementById('celebrationSubtitle'), startNewGoalBtn: document.getElementById('startNewGoalBtn')
        };
        
        const state = { goalName: 'ğŸŒ¸ ç›®æ¨™å€’æ•¸ ğŸŒ¸', totalDays: 30, remainingDays: 30, theme: 'spring' };
        
        // âœ¨ ç§»é™¤ motivationalQuotes é™£åˆ—
        
        const dailyCompletionMessages = [ 'å¤ªæ£’äº†ï¼åˆå®Œæˆä¸€å¤© âœ¨', 'é›¢ç›®æ¨™åˆæ›´è¿‘ä¸€æ­¥äº†ï¼ğŸš€', 'ä»Šå¤©çš„åŠªåŠ›ï¼Œæˆå°±æ˜å¤©çš„ä½ ã€‚', 'å …æŒä¸‹å»ï¼Œä½ åšå¾—å¾ˆå¥½ï¼ğŸ‘', 'åˆç´¯ç©äº†ä¸€å¤©çš„é€²åº¦ï¼ŒçœŸäº†ä¸èµ·ï¼', 'ç‚ºä»Šå¤©çš„è‡ªå·±å–é‡‡ï¼ğŸ‘' ];
        
        function applyTheme(themeName) {
            state.theme = themeName; const root = document.documentElement;
            root.style.setProperty('--theme-primary', `var(--c-${themeName}-primary)`);
            root.style.setProperty('--theme-secondary', `var(--c-${themeName}-secondary)`);
            root.style.setProperty('--theme-background', `var(--c-${themeName}-bg)`);
            root.style.setProperty('--theme-shadow', `var(--c-${themeName}-shadow)`);
            const themeColor = getComputedStyle(root).getPropertyValue(`--c-${themeName}-primary`);
            document.querySelector('meta[name="theme-color"]').setAttribute('content', themeColor.trim());
            document.querySelectorAll('.theme-option').forEach(opt => { opt.classList.toggle('selected', opt.dataset.theme === themeName); });
        }
        
        function loadData() { const savedState = JSON.parse(localStorage.getItem('countdownStateV2')); if (savedState) { Object.assign(state, savedState); } else { setTimeout(() => showSettingsModal(), 500); } applyTheme(state.theme || 'spring'); }
        function saveData() { localStorage.setItem('countdownStateV2', JSON.stringify(state)); }
        function triggerHapticFeedback() { if (navigator.vibrate) navigator.vibrate(50); }
        function animateElement(element, value) { if (element.textContent !== String(value)) { element.classList.add('animate-pop'); setTimeout(() => { element.textContent = value; element.classList.remove('animate-pop'); }, 150); } }
        
        function updateUI() {
            if (state.remainingDays === 0 && (state.totalDays > 0)) {
                dom.mainContent.classList.add('hide'); dom.celebrationScreen.classList.add('show');
                dom.celebrationSubtitle.textContent = `æ‚¨å …æŒäº† ${state.totalDays} å¤©ï¼Œå®Œæˆäº†ã€Œ${state.goalName}ã€çš„æŒ‘æˆ°ï¼`;
            } else { dom.mainContent.classList.remove('hide'); dom.celebrationScreen.classList.remove('show'); }
            const completedDays = state.totalDays - state.remainingDays;
            const percentage = state.totalDays > 0 ? (completedDays / state.totalDays) * 100 : 0;
            dom.goalTitle.textContent = state.goalName; animateElement(dom.daysRemaining, state.remainingDays);
            animateElement(dom.totalDays, state.totalDays); animateElement(dom.completedDays, completedDays);
            const radius = 85; const circumference = 2 * Math.PI * radius; const offset = circumference - (percentage / 100) * circumference;
            dom.progress.style.strokeDasharray = `${circumference} ${circumference}`; dom.progress.style.strokeDashoffset = offset;
            dom.increaseBtn.disabled = state.remainingDays === 0; dom.decreaseBtn.disabled = state.remainingDays === state.totalDays;
            saveData();
        }

        function showMessage(text) { dom.message.textContent = text; dom.message.classList.add('show'); setTimeout(() => { dom.message.classList.remove('show'); }, 3000); }
        
        // âœ¨ ç§»é™¤ updateQuote å‡½å¼
        
        function displayCurrentDate() { const today = new Date(); const year = today.getFullYear(); const month = today.getMonth() + 1; const day = today.getDate(); const weekDay = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][today.getDay()]; const dateString = `${year} å¹´ ${month} æœˆ ${day} æ—¥ æ˜ŸæœŸ${weekDay}`; dom.currentDateDisplay.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>${dateString}`; }
        function showSettingsModal(isNew = false) { if (isNew) { state.goalName = 'ğŸŒ¸ æ–°çš„ç›®æ¨™ ğŸŒ¸'; state.totalDays = 30; state.remainingDays = 30; } dom.goalNameInput.value = state.goalName === 'ğŸŒ¸ æ–°çš„ç›®æ¨™ ğŸŒ¸' ? '' : state.goalName; dom.totalDaysInput.value = state.totalDays; applyTheme(state.theme); dom.settingsModal.classList.add('show'); dom.goalNameInput.focus(); }
        function hideSettingsModal() { dom.settingsModal.classList.remove('show'); }
        function handleSaveSettings() { const newGoalName = dom.goalNameInput.value.trim(); const newTotalDays = parseInt(dom.totalDaysInput.value); if (!newGoalName) { showMessage("è«‹çµ¦ä½ çš„ç›®æ¨™å–å€‹åå­—å§ï¼"); return; } if (isNaN(newTotalDays) || newTotalDays <= 0) { showMessage("ç¸½å¤©æ•¸å¿…é ˆæ˜¯æ­£æ•¸å–”ï¼"); return; } state.goalName = newGoalName; state.totalDays = newTotalDays; state.remainingDays = newTotalDays; updateUI(); hideSettingsModal(); showMessage('æ–°ç›®æ¨™å·²è¨­å®šï¼åŠ æ²¹ ğŸ’ª'); }
        
        dom.increaseBtn.addEventListener('click', () => {
            if (state.remainingDays > 0) {
                triggerHapticFeedback(); state.remainingDays--; updateUI();
                if (state.remainingDays > 0) {
                    if (state.remainingDays <= 10) { showMessage(`ğŸ’ª åŠ æ²¹ï¼åªå‰© ${state.remainingDays} å¤©äº†ï¼`); } 
                    else { const randomIndex = Math.floor(Math.random() * dailyCompletionMessages.length); showMessage(dailyCompletionMessages[randomIndex]); }
                }
            }
        });
        
        dom.decreaseBtn.addEventListener('click', () => { if (state.remainingDays < state.totalDays) { triggerHapticFeedback(); state.remainingDays++; updateUI(); showMessage('å·²é€€å›ä¸€å¤© â†©ï¸'); } });
        dom.resetBtn.addEventListener('click', () => showSettingsModal(false));
        dom.startNewGoalBtn.addEventListener('click', () => showSettingsModal(true));
        dom.saveSettingsBtn.addEventListener('click', handleSaveSettings);
        dom.cancelSettingsBtn.addEventListener('click', hideSettingsModal);
        dom.themeSelector.addEventListener('click', (e) => { if (e.target.classList.contains('theme-option')) { applyTheme(e.target.dataset.theme); } });
        
        function init() { loadData(); updateUI(); displayCurrentDate(); }
        init();
    </script>
</body>
</html>